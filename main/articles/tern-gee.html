<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to tern.gee • tern.gee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to tern.gee">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tern.gee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4.9004</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/tern-gee.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/tern.gee"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to tern.gee</h1>
            
            <h4 data-toc-skip class="date">2024-08-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/tern.gee/blob/main/vignettes/tern-gee.Rmd" class="external-link"><code>vignettes/tern-gee.Rmd</code></a></small>
      <div class="d-none name"><code>tern-gee.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Generalized Estimating Equations (GEEs) are mainly used for modeling
longitudinal binary or count endpoints from clinical trials. Within this
package, a GEE is used to estimate the parameters of a generalized
linear model that includes as fixed effects the variables: treatment
arm, categorical visit, and other covariates for adjustment (e.g. age,
sex, race). The covariance structure of the residuals can take on
different forms. Often, an unstructured (i.e. saturated
parameterization) covariance matrix is assumed which can be represented
by random effects in the model.</p>
<p>This vignette shows the general purpose and syntax of the
<code>tern.gee</code> R package which provides an interface for GEEs
within the <code>tern</code> framework. This package builds upon some of
the GEE functionality included in the <code>geepack</code> and
<code>geeasy</code> R packages. Within this package, we have implemented
GEEs in R in such a way that they can easily be embedded into a
<code>shiny</code> application. See
<code><a href="https://insightsengineering.github.io/teal.modules.clinical/latest-tag/reference/tm_a_gee.html" class="external-link">teal.modules.clinical::tm_a_gee()</a></code> and the <a href="https://insightsengineering.github.io/teal.modules.clinical/" class="external-link"><code>teal.modules.clinical</code>
package</a> for more details about using this code inside a
<code>shiny</code> application.</p>
<hr>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Here we will demonstrate how the <code>tern.gee</code> package
functionality can be used to fit a GEE model and tabulate its
output.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>Our sample dataset, <code>fev_data</code>, is available in the
<code>tern.gee</code> package and consists of seven variables: subject
ID (<code>USUBJID</code>), visit number (<code>AVISIT</code>), treatment
(<code>ARMCD</code> = TRT or PBO), 3-category <code>RACE</code>,
<code>SEX</code>, FEV1 at baseline (%) (<code>FEV1_BL</code>), and FEV1
at study visits (%) (<code>FEV1</code>). Additionally we create an
arbitrary binary variable <code>FEV1_BINARY</code> for our analysis
which takes a value of 1 where <code>FEV1 &gt; 30</code> and 0
otherwise. FEV1 (forced expired volume in one second) is a measure of
how quickly the lungs can be emptied. Low levels of FEV1 may indicate
chronic obstructive pulmonary disease (COPD). The scientific question at
hand is whether treatment leads to an increase in FEV1 over time after
adjusting for baseline covariates.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/tern.gee/">tern.gee</a></span><span class="op">)</span></span>
<span><span class="va">fev_data</span><span class="op">$</span><span class="va">FEV1_BINARY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">fev_data</span><span class="op">$</span><span class="va">FEV1</span> <span class="op">&gt;</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fev_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   USUBJID AVISIT ARMCD RACE                      SEX   FEV1_BL  FEV1 FEV1_BINARY</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PT1     VIS1   TRT   Black or African American Fema…    25.3  <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PT1     VIS2   TRT   Black or African American Fema…    25.3  40.0           1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PT1     VIS3   TRT   Black or African American Fema…    25.3  <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PT1     VIS4   TRT   Black or African American Fema…    25.3  20.5           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> PT2     VIS1   PBO   Asian                     Male     45.0  <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> PT2     VIS2   PBO   Asian                     Male     45.0  31.5           1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>Fitting a GEE model is easy when you use <code>tern.gee</code>. By
default, the model fitting function <code><a href="../reference/fit_gee.html">fit_gee()</a></code> assumes
unstructured correlation and proportional weights when calculating LS
means, and fits a logistic regression model. Currently only logistic
regression has been implemented as an available regression model when
using <code><a href="../reference/fit_gee.html">fit_gee()</a></code>. In future the package will be extended to
include other models such as Poisson regression, etc. as alternative
options.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fev_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_gee.html">fit_gee</a></span><span class="op">(</span></span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    response <span class="op">=</span> <span class="st">"FEV1_BINARY"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"SEX"</span>, <span class="st">"FEV1_BL"</span><span class="op">)</span>,</span>
<span>    arm <span class="op">=</span> <span class="st">"ARMCD"</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"AVISIT"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">fev_data</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Registered S3 methods overwritten by 'geeasy':</span></span>
<span><span class="co">#&gt;   method       from   </span></span>
<span><span class="co">#&gt;   drop1.geeglm MESS   </span></span>
<span><span class="co">#&gt;   drop1.geem   MESS   </span></span>
<span><span class="co">#&gt;   plot.geeglm  geepack</span></span>
<span><span class="va">fev_fit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; geeasy::geelm(formula = formula, id = .id, waves = .waves, data = data, </span></span>
<span><span class="co">#&gt;     family = family$object, corstr = cor_details$str, Mv = cor_details$mv, </span></span>
<span><span class="co">#&gt;     control = family$control)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                   (Intercept)                      ARMCDTRT </span></span>
<span><span class="co">#&gt;                   -0.20061892                    0.74524533 </span></span>
<span><span class="co">#&gt; RACEBlack or African American                     RACEWhite </span></span>
<span><span class="co">#&gt;                    0.11627212                    1.38199917 </span></span>
<span><span class="co">#&gt;                     SEXFemale                       FEV1_BL </span></span>
<span><span class="co">#&gt;                   -0.14521343                    0.05257141 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Degrees of Freedom: 537 Total (i.e. Null);  531 Residual</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scale is fixed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation:  Structure = unstructured    Link = identity </span></span>
<span><span class="co">#&gt; Estimated Correlation Parameters:</span></span>
<span><span class="co">#&gt; [1] -0.046922366 -0.130175920  0.071402079 -0.126586549 -0.062642853</span></span>
<span><span class="co">#&gt; [6]  0.006795836</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of clusters:   197   Maximum cluster size: 4</span></span></code></pre></div>
<p>The resulting object consists of many pieces of information
pertaining to the model such as the estimated coefficients, correlation
parameters, etc. Additionally, the <code><a href="../reference/lsmeans.html">lsmeans()</a></code> function from
<code>tern.gee</code> can be used to extract the least squares means
from any GEE model created using <code><a href="../reference/fit_gee.html">fit_gee()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fev_lsmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lsmeans.html">lsmeans</a></span><span class="op">(</span><span class="va">fev_fit</span>, data <span class="op">=</span> <span class="va">fev_data</span><span class="op">)</span></span>
<span><span class="va">fev_lsmeans</span></span>
<span><span class="co">#&gt;   ARMCD  prop_est prop_est_se prop_lower_cl prop_upper_cl   n   or_est</span></span>
<span><span class="co">#&gt; 1   PBO 0.9054200  0.01904206     0.8608217     0.9367768 420       NA</span></span>
<span><span class="co">#&gt; 2   TRT 0.9527634  0.01193578     0.9229565     0.9713959 380 2.106958</span></span>
<span><span class="co">#&gt;   or_lower_cl or_upper_cl log_or_est log_or_lower_cl log_or_upper_cl conf_level</span></span>
<span><span class="co">#&gt; 1          NA          NA         NA              NA              NA       0.95</span></span>
<span><span class="co">#&gt; 2    1.125774    3.943307  0.7452453        0.118471         1.37202       0.95</span></span></code></pre></div>
<p>Based on the output, there is evidence to support that treatment
leads to an increase in FEV1 over placebo. The GEE model can be refined
by using different correlation structures and weighting schemes.</p>
</div>
<div class="section level3">
<h3 id="tabulation">Tabulation<a class="anchor" aria-label="anchor" href="#tabulation"></a>
</h3>
<p>After fitting a GEE model and extracting the LS means you may want to
display your results in a table. The <code>tern.gee</code> package
contains functionality to summarize the results of a
<code><a href="../reference/lsmeans.html">lsmeans()</a></code> object in an <code>rtable</code> structure, using
additional functions from the <a href="https://insightsengineering.github.io/rtables/" class="external-link"><code>rtables</code>
package</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fev_counts</span> <span class="op">&lt;-</span> <span class="va">fev_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">ARMCD</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fev_gee_table</span> <span class="op">&lt;-</span> <span class="fu">basic_table</span><span class="op">(</span>show_colcounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">split_cols_by</span><span class="op">(</span><span class="st">"ARMCD"</span>, ref_group <span class="op">=</span> <span class="st">"PBO"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/tabulate_gee.html">summarize_gee_logistic</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">build_table</span><span class="op">(</span><span class="va">fev_lsmeans</span>, alt_counts_df <span class="op">=</span> <span class="va">fev_counts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fev_gee_table</span></span>
<span><span class="co">#&gt;                                     PBO            TRT     </span></span>
<span><span class="co">#&gt;                                   (N=105)         (N=95)   </span></span>
<span><span class="co">#&gt; ———————————————————————————————————————————————————————————</span></span>
<span><span class="co">#&gt; n                                   420            380     </span></span>
<span><span class="co">#&gt; Adjusted Mean Proportion (SE)   0.91 (0.02)    0.95 (0.01) </span></span>
<span><span class="co">#&gt;   95% CI                        (0.86, 0.94)   (0.92, 0.97)</span></span>
<span><span class="co">#&gt; Odds Ratio                                         2.11    </span></span>
<span><span class="co">#&gt;   95% CI                                       (1.13, 3.94)</span></span>
<span><span class="co">#&gt; Log Odds Ratio                                     0.75    </span></span>
<span><span class="co">#&gt;   95% CI                                       (0.12, 1.37)</span></span></code></pre></div>
<p>First we create a table <code>fev_counts</code> to get the number of
unique subjects receiving each treatment. These counts are displayed in
the header of the table under each of the column names by specifying
<code>show_colcounts = TRUE</code> when initializing the table via the
<code>basic_table()</code> function. The table is split by arm
(<code>ARMCD</code>), with <code>PBO</code> specified as the reference
group to compare the <code>TRT</code> group to. Then the
<code><a href="../reference/tabulate_gee.html">summarize_gee_logistic()</a></code> function from
<code>tern.gee</code> is applied. Finally, the
<code>build_table()</code> function builds the <code>rtable</code> using
our LS means dataset with <code>fev_counts</code> providing the counts
of unique subjects in each arm.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>tern.gee is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
